---
// Format stars to k if >= 1000
function shortenNumberWithK(number: number) {
  if (number >= 10000) {
    return `${Math.floor(number / 1000)}k`;
  } else if (number >= 1000) {
    return `${Math.floor(number / 100) / 10}k`;
  } else {
    return `${number}`;
  }
}

interface RepoDetails {
  id: number;
  owner: string;
  owner_url: string;
  name: string;
  full_name: string;
  html_url: string;
  description: string;
  created_at: string;
  updated_at: string;
  pushed_at: string;
  stars: number;
  language: string;
  topics: string[];
  license: {
    key: string;
    name: string;
    spdx_id: string;
    url: string;
    node_id: string;
  };
}

interface Props {
  repo: RepoDetails;
}

const { repo } = Astro.props;
---

<div
  id={`project-${repo.id}`}
  class="rounded-2xl border border-[--accent-light] bg-[#1A1420] shadow-lg"
>
  <div class="p-4">
    <div class="flex flex-col gap-1">
      <div class="flex items-center justify-between">
        <a
          href={repo.html_url}
          target="_blank"
          class="passing-underline flex-none text-sm font-bold text-gray-200 hover:text-gray-200"
        >
          {repo.name}
        </a>
      </div>
      <p class="text-sm text-gray-400">{repo.description}</p>
      <div class="flex flex-wrap gap-x-2">
        {
          repo.topics.map((topic) => (
            <a
              href="https://github.com/topics/"
              target="_blank"
              class="text-[10px] font-semibold uppercase text-gray-400"
            >
              {topic}
            </a>
          ))
        }
      </div>
      <div class="flex gap-3 pt-2 text-xs text-gray-400">
        <div class="inline-flex items-center gap-1">
          <svg
            fill="#eac54f"
            aria-hidden="true"
            height="16"
            viewBox="0 0 16 16"
            version="1.1"
            width="16"
            data-view-component="true"
            class="octicon octicon-star-fill starred-button-icon d-inline-block"
          >
            <path
              d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"
            ></path>
          </svg>
          <p class="">{shortenNumberWithK(repo.stars)} stars</p>
        </div>
        <div class="inline-flex items-center">
          <p class="">{repo.language}</p>
        </div>

        {
          repo.license && (
            <div class="inline-flex items-center">
              <span class="">{repo.license.spdx_id}</span>
            </div>
          )
        }
      </div>
    </div>
  </div>
</div>
